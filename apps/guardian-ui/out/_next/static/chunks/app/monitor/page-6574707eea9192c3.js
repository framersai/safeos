(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[506],{9291:function(e,t,s){Promise.resolve().then(s.bind(s,10601))},10601:function(e,t,s){"use strict";s.r(t),s.d(t,{default:function(){return F}});var l=s(57437),a=s(2265),r=s(27648);let n={pet:{low:5,medium:15,high:30},baby:{low:3,medium:10,high:25},elderly:{low:2,medium:8,high:20}},i={pet:{ambient:15,bark:45,distress:65},baby:{ambient:10,fuss:25,cry:40,scream:70},elderly:{ambient:12,speech:25,call:45,distress:60}},c=[],d=null;function o(e,t,s){if(s<=t)return 0;let l=0,a=Math.min(s,e.length);for(let s=t;s<a;s++)l+=e[s];return l/(a-t)}function u(e){var t,s;let{onFrame:r,onError:u,scenario:h="baby",enabled:b=!0,showDebug:g=!1}=e,f=(0,a.useRef)(null),p=(0,a.useRef)(null),v=(0,a.useRef)(null),j=(0,a.useRef)(null),N=(0,a.useRef)(null),w=(0,a.useRef)(null),[y,k]=(0,a.useState)(!0),[C,D]=(0,a.useState)(null),[E,M]=(0,a.useState)(0),[S,z]=(0,a.useState)(0),[A,I]=(0,a.useState)(!1),[R,F]=(0,a.useState)(!1),T=(null===(s=n[h])||void 0===s?void 0:s.medium)||10,O=(null===(t=i[h])||void 0===t?void 0:t.ambient)||15,L=(0,a.useCallback)(async()=>{try{k(!0),D(null);let e=await navigator.mediaDevices.getUserMedia({video:{width:{ideal:1280},height:{ideal:720},facingMode:"environment"},audio:!0});w.current=e,f.current&&(f.current.srcObject=e,await f.current.play()),j.current=new AudioContext;let t=j.current.createMediaStreamSource(e);N.current=j.current.createAnalyser(),N.current.fftSize=256,t.connect(N.current),F(!0),k(!1)}catch(t){let e=t instanceof Error?t.message:"Failed to access camera";D(e),k(!1),null==u||u(t instanceof Error?t:Error(e))}},[u]),q=(0,a.useCallback)(()=>{w.current&&(w.current.getTracks().forEach(e=>e.stop()),w.current=null),j.current&&(j.current.close(),j.current=null),F(!1)},[]);return(0,a.useEffect)(()=>(b&&L(),()=>{q()}),[b,L,q]),(0,a.useEffect)(()=>{if(!R||!p.current||!f.current)return;let e=p.current,t=e.getContext("2d",{willReadFrequently:!0});if(!t)return;let s=setInterval(()=>{if(!f.current)return;e.width=f.current.videoWidth||640,e.height=f.current.videoHeight||480,t.drawImage(f.current,0,0);let s=t.getImageData(0,0,e.width,e.height);v.current&&M(Math.round(100*function(e,t){let s=e.data,l=t.data,a=e.width,r=e.height,n=0,i=0;for(let e=0;e<r;e+=4)for(let t=0;t<a;t+=4){let r=(e*a+t)*4;Math.abs((s[r]+s[r+1]+s[r+2])/3-(l[r]+l[r+1]+l[r+2])/3)>30&&n++,i++}return i>0?n/i:0}(v.current,s))),v.current=s},200);return()=>clearInterval(s)},[R]),(0,a.useEffect)(()=>{if(!R||!N.current)return;let e=setInterval(()=>{N.current&&(z(Math.round(100*function(e){let t=e.frequencyBinCount,s=new Uint8Array(t);e.getByteFrequencyData(s);let l=0;for(let e=0;e<t;e++)l+=s[e]*s[e];return Math.sqrt(l/t)/255}(N.current))),"baby"===h&&N.current&&I(function(e){let t=e.frequencyBinCount,s=new Uint8Array(t);e.getByteFrequencyData(s);let l=e.context.sampleRate/e.fftSize,a=Math.floor(300/l),r=Math.floor(600/l),n=o(s,a,r),i=o(s,0,a),u=o(s,r,t);c.push(n>(i+u)/2*1.5&&n>50?1:0),c.length>20&&c.shift();let x=c.reduce((e,t)=>e+t,0)/c.length>=.6&&c.length>=5;return x&&!d?d=Date.now():x||(d=null),x}(N.current)))},100);return()=>clearInterval(e)},[R,h]),(0,a.useEffect)(()=>{if(!R||!p.current)return;let e=setInterval(()=>{(!(E<T)||!(S<O))&&p.current&&r&&r({imageData:p.current.toDataURL("image/jpeg",.7),motionScore:E,audioLevel:S,timestamp:Date.now(),hasCrying:A})},1e3);return()=>clearInterval(e)},[R,E,S,T,O,A,r]),(0,l.jsxs)("div",{className:"relative w-full aspect-video bg-slate-900 rounded-xl overflow-hidden",children:[(0,l.jsx)("video",{ref:f,autoPlay:!0,playsInline:!0,muted:!0,className:"w-full h-full object-cover"}),(0,l.jsx)("canvas",{ref:p,className:"hidden"}),y&&(0,l.jsx)("div",{className:"absolute inset-0 flex items-center justify-center bg-slate-900/80",children:(0,l.jsxs)("div",{className:"text-center",children:[(0,l.jsx)("div",{className:"w-12 h-12 border-4 border-slate-600 border-t-emerald-500 rounded-full animate-spin mx-auto"}),(0,l.jsx)("p",{className:"text-slate-400 mt-4 text-sm",children:"Initializing camera..."})]})}),C&&(0,l.jsx)("div",{className:"absolute inset-0 flex items-center justify-center bg-slate-900/80",children:(0,l.jsxs)("div",{className:"text-center px-4",children:[(0,l.jsx)("div",{className:"w-12 h-12 rounded-full bg-red-500/20 flex items-center justify-center mx-auto",children:(0,l.jsx)("span",{className:"text-2xl",children:"\uD83D\uDCF7"})}),(0,l.jsx)("p",{className:"text-red-400 mt-4 text-sm font-medium",children:"Camera Error"}),(0,l.jsx)("p",{className:"text-slate-500 mt-1 text-xs max-w-xs",children:C}),(0,l.jsx)("button",{onClick:L,className:"mt-4 px-4 py-2 bg-slate-700 hover:bg-slate-600 text-white rounded-lg text-sm transition-colors",children:"Retry"})]})}),R&&!C&&(0,l.jsxs)(l.Fragment,{children:[(0,l.jsxs)("div",{className:"absolute top-4 left-4 flex items-center gap-2 px-3 py-1.5 bg-slate-900/60 rounded-full backdrop-blur-sm",children:[(0,l.jsx)("div",{className:"w-2 h-2 rounded-full bg-red-500 animate-pulse"}),(0,l.jsx)("span",{className:"text-xs text-white",children:"LIVE"})]}),(0,l.jsxs)("div",{className:"absolute top-4 right-4 flex items-center gap-2",children:[(0,l.jsx)(x,{score:E,threshold:T}),(0,l.jsx)(m,{level:S,threshold:O,hasCrying:A})]}),g&&(0,l.jsx)("div",{className:"absolute bottom-4 left-4 right-4 p-3 bg-slate-900/80 rounded-lg backdrop-blur-sm",children:(0,l.jsxs)("div",{className:"grid grid-cols-3 gap-4 text-xs",children:[(0,l.jsxs)("div",{children:[(0,l.jsx)("span",{className:"text-slate-500",children:"Motion:"}),(0,l.jsxs)("span",{className:"text-white ml-2",children:[E,"%"]})]}),(0,l.jsxs)("div",{children:[(0,l.jsx)("span",{className:"text-slate-500",children:"Audio:"}),(0,l.jsxs)("span",{className:"text-white ml-2",children:[S,"%"]})]}),(0,l.jsxs)("div",{children:[(0,l.jsx)("span",{className:"text-slate-500",children:"Threshold:"}),(0,l.jsxs)("span",{className:"text-white ml-2",children:[T,"%"]})]}),"baby"===h&&(0,l.jsxs)("div",{className:"col-span-3",children:[(0,l.jsx)("span",{className:"text-slate-500",children:"Cry Detection:"}),(0,l.jsx)("span",{className:"ml-2 ".concat(A?"text-red-400":"text-slate-300"),children:A?"DETECTED":"None"})]})]})})]})]})}function x(e){let{score:t,threshold:s}=e,a=t>=s;return(0,l.jsxs)("div",{className:"px-3 py-1.5 ".concat(a?"bg-orange-500/80":t>s/2?"bg-yellow-500/80":"bg-slate-700/80"," rounded-full backdrop-blur-sm flex items-center gap-2"),children:[(0,l.jsx)("span",{className:"text-lg",children:"\uD83D\uDC41️"}),(0,l.jsx)("div",{className:"w-16 h-1.5 bg-slate-600 rounded-full overflow-hidden",children:(0,l.jsx)("div",{className:"h-full ".concat(a?"bg-orange-400":"bg-emerald-400"," transition-all duration-200"),style:{width:"".concat(Math.min(t,100),"%")}})})]})}function m(e){let{level:t,threshold:s,hasCrying:a}=e,r=t>=s||a;return(0,l.jsxs)("div",{className:"px-3 py-1.5 ".concat(a?"bg-red-500/80 animate-pulse":r?"bg-orange-500/80":"bg-slate-700/80"," rounded-full backdrop-blur-sm flex items-center gap-2"),children:[(0,l.jsx)("span",{className:"text-lg",children:a?"\uD83D\uDE22":"\uD83D\uDD0A"}),(0,l.jsx)("div",{className:"w-12 h-1.5 bg-slate-600 rounded-full overflow-hidden",children:(0,l.jsx)("div",{className:"h-full ".concat(a?"bg-red-400":r?"bg-orange-400":"bg-emerald-400"," transition-all duration-100"),style:{width:"".concat(Math.min(t,100),"%")}})})]})}var h=s(73881),b=s(54426),g=s(27454),f=s(66454),p=s(66471);let v=[{level:1,delay:0,volume:.3,sound:"notification"},{level:2,delay:3e4,volume:.5,sound:"alert"},{level:3,delay:6e4,volume:.7,sound:"warning"},{level:4,delay:12e4,volume:.9,sound:"alarm"},{level:5,delay:18e4,volume:1,sound:"emergency"}],j={info:{bg:"bg-blue-500/20",border:"border-blue-500/50",text:"text-blue-400",flash:"border-blue-500"},low:{bg:"bg-emerald-500/20",border:"border-emerald-500/50",text:"text-emerald-400",flash:"border-emerald-500"},medium:{bg:"bg-yellow-500/20",border:"border-yellow-500/50",text:"text-yellow-400",flash:"border-yellow-500"},high:{bg:"bg-orange-500/20",border:"border-orange-500/50",text:"text-orange-400",flash:"border-orange-500"},critical:{bg:"bg-red-500/20",border:"border-red-500/50",text:"text-red-400",flash:"border-red-500"}};function N(e){let{alerts:t,onAcknowledge:s}=e,r=(0,b.m5)(e=>e.alerts),n=(0,b.m5)(e=>e.removeAlert),{globalSettings:i,emergencyModeActive:c,activateEmergencyMode:d,deactivateEmergencyMode:o}=(0,g.F2)(),u=t||r||[],[x,m]=(0,a.useState)(new Map),[j,N]=(0,a.useState)(!1),[D,E]=(0,a.useState)(!1),[M,S]=(0,a.useState)(!1),z=(0,a.useRef)(new Map),A=(0,a.useRef)(new Map),I=(0,a.useRef)(null),R=(0,a.useRef)(null);(0,f.Z)(),(0,a.useEffect)(()=>{let e={notification:"/sounds/notification.mp3",alert:"/sounds/alert.mp3",warning:"/sounds/warning.mp3",alarm:"/sounds/alarm.mp3",emergency:"/sounds/emergency.mp3"};return Object.entries(e).forEach(e=>{let[t,s]=e;z.current.set(t,new h.Howl({src:[s],volume:.5,preload:!0,html5:!0}))}),I.current=new h.Howl({src:[e.emergency],volume:1,loop:!0,preload:!0,html5:!0}),()=>{var e;z.current.forEach(e=>e.unload()),z.current.clear(),null===(e=I.current)||void 0===e||e.unload(),A.current.forEach(e=>clearTimeout(e)),A.current.clear()}},[]),(0,a.useEffect)(()=>{c&&!D?(E(!0),F()):!c&&D&&(E(!1),T())},[c]),(0,a.useEffect)(()=>{let e=u.filter(e=>"critical"===e.severity&&!e.acknowledged);if(e.length>0&&i.emergencyMode&&!D){let t=e[0];d(t.id),R.current=t.id}},[u,i.emergencyMode,D]),(0,a.useEffect)(()=>{u.filter(e=>!e.acknowledged).forEach(e=>{let t=x.get(e.id)||1,s=Date.now()-new Date(e.createdAt).getTime(),l=1;for(let e of v)s>=e.delay&&(l=e.level);if(l!==t){if(m(t=>new Map(t).set(e.id,l)),l>=5&&i.emergencyMode&&!D)d(e.id),R.current=e.id;else if(!j&&!D){let e=v.find(e=>e.level===l);if(e){let t=z.current.get(e.sound);t&&(t.volume(e.volume),t.play())}}}let a=v.find(e=>e.level===l+1);if(a){let t=a.delay-s;if(t>0){let s=A.current.get(e.id);s&&clearTimeout(s);let l=setTimeout(()=>{m(t=>new Map(t).set(e.id,a.level))},t);A.current.set(e.id,l)}}})},[u,x,j,i.emergencyMode,D]);let F=(0,a.useCallback)(()=>{E(!0),S(!0),I.current&&(I.current.volume(1),I.current.play()),navigator.vibrate&&navigator.vibrate([500,200,500,200,500])},[]),T=(0,a.useCallback)(()=>{E(!1),S(!1),I.current&&I.current.stop(),o(),R.current=null},[o]),O=(0,a.useCallback)(async e=>{try{let t=A.current.get(e);t&&clearTimeout(t),A.current.delete(e),m(t=>{let s=new Map(t);return s.delete(e),s}),await fetch("".concat("http://localhost:3001","/api/alerts/").concat(e,"/acknowledge"),{method:"POST"}).catch(()=>{}),s?s(e):n(e)}catch(e){console.error("Failed to acknowledge alert:",e)}},[s,n]),L=(0,a.useCallback)(async e=>{T(),await O(e)},[T,O]),q=u.filter(e=>!e.acknowledged),U=u.filter(e=>e.acknowledged);return(0,l.jsxs)(l.Fragment,{children:[M&&D&&(0,l.jsx)(w,{alert:u.find(e=>e.id===R.current),onDismiss:L}),(0,l.jsxs)("div",{className:"bg-slate-800/50 rounded-xl border overflow-hidden transition-all ".concat(D?"border-red-500 animate-pulse-border":"border-slate-700/50"),children:[(0,l.jsxs)("div",{className:"p-4 border-b border-slate-700/50 flex items-center justify-between",children:[(0,l.jsxs)("h3",{className:"font-semibold text-white flex items-center gap-2",children:[(0,l.jsx)(p.YK,{size:18}),"Alerts",q.length>0&&(0,l.jsx)("span",{className:"px-2 py-0.5 bg-red-500/20 text-red-400 rounded-full text-xs",children:q.length}),D&&(0,l.jsx)("span",{className:"px-2 py-0.5 bg-red-500 text-white rounded-full text-xs animate-pulse",children:"EMERGENCY"})]}),(0,l.jsxs)("div",{className:"flex items-center gap-2",children:[D&&(0,l.jsx)("button",{onClick:()=>S(!0),className:"p-2 rounded-lg bg-red-500/20 text-red-400 hover:bg-red-500/30 transition-colors",title:"View emergency alert",children:(0,l.jsx)(p.Dp,{size:18})}),(0,l.jsx)("button",{onClick:()=>{N(!j),j||z.current.forEach(e=>e.stop())},className:"p-2 rounded-lg transition-colors ".concat(j?"bg-red-500/20 text-red-400":"bg-slate-700/50 text-slate-400 hover:text-white"),title:j?"Unmute alerts":"Mute alerts",children:j?(0,l.jsx)(p.dr,{size:18}):(0,l.jsx)(p.ue,{size:18})})]})]}),(0,l.jsx)("div",{className:"max-h-[400px] overflow-y-auto",children:0===u.length?(0,l.jsx)(C,{}):(0,l.jsxs)("div",{className:"divide-y divide-slate-700/50",children:[q.map(e=>(0,l.jsx)(y,{alert:e,escalationLevel:x.get(e.id)||1,onAcknowledge:O,isEmergency:D&&e.id===R.current},e.id)),U.length>0&&(0,l.jsx)(k,{alerts:U})]})})]})]})}function w(e){let{alert:t,onDismiss:s}=e,[r,n]=(0,a.useState)(0),[i,c]=(0,a.useState)(!1),d=(0,a.useRef)(null),o=(0,a.useRef)(null);(0,a.useEffect)(()=>{if(i){let e=()=>{if(d.current){let l=Math.min((Date.now()-d.current)/3e3*100,100);if(n(l),l>=100&&t){s(t.id);return}o.current=requestAnimationFrame(e)}};e()}return()=>{o.current&&cancelAnimationFrame(o.current)}},[i,t,s]);let u=()=>{d.current=Date.now(),c(!0),navigator.vibrate&&navigator.vibrate(50)},x=()=>{d.current=null,c(!1),n(0),o.current&&cancelAnimationFrame(o.current)};return t?(0,l.jsxs)("div",{className:"fixed inset-0 z-[9999] flex items-center justify-center bg-black/90 animate-emergency-flash",children:[(0,l.jsx)("div",{className:"absolute inset-0 border-8 border-red-500 animate-pulse-border pointer-events-none"}),(0,l.jsxs)("div",{className:"relative max-w-lg w-full mx-4 bg-slate-900 rounded-2xl border-4 border-red-500 p-8 shadow-2xl shadow-red-500/30",children:[(0,l.jsx)("div",{className:"flex justify-center mb-6",children:(0,l.jsx)("div",{className:"w-24 h-24 rounded-full bg-red-500/20 flex items-center justify-center animate-pulse",children:(0,l.jsx)(p.xq,{size:48,className:"text-red-500"})})}),(0,l.jsx)("h1",{className:"text-3xl font-bold text-red-500 text-center mb-2 animate-pulse",children:"EMERGENCY ALERT"}),(0,l.jsx)("p",{className:"text-slate-400 text-center text-sm mb-6",children:"Critical alert requires immediate attention"}),(0,l.jsxs)("div",{className:"bg-red-500/10 rounded-xl p-4 mb-8 border border-red-500/30",children:[(0,l.jsxs)("div",{className:"flex items-center gap-2 mb-2",children:[(0,l.jsx)(p.Dp,{size:20,className:"text-red-500"}),(0,l.jsx)("span",{className:"text-red-400 font-semibold uppercase text-sm",children:t.severity}),(0,l.jsx)("span",{className:"text-slate-500 text-xs ml-auto",children:D(t.createdAt)})]}),(0,l.jsx)("p",{className:"text-white text-lg",children:t.message}),t.thumbnailUrl&&(0,l.jsx)("div",{className:"mt-4 rounded-lg overflow-hidden",children:(0,l.jsx)("img",{src:t.thumbnailUrl,alt:"Alert thumbnail",className:"w-full h-32 object-cover"})})]}),(0,l.jsxs)("div",{className:"relative",children:[(0,l.jsxs)("button",{onMouseDown:u,onMouseUp:x,onMouseLeave:x,onTouchStart:u,onTouchEnd:x,className:"w-full py-4 px-6 rounded-xl bg-red-600 hover:bg-red-700 text-white font-bold text-lg transition-colors relative overflow-hidden select-none",children:[(0,l.jsx)("div",{className:"absolute left-0 top-0 bottom-0 bg-emerald-500 transition-all duration-100",style:{width:"".concat(r,"%")}}),(0,l.jsx)("span",{className:"relative z-10 flex items-center justify-center gap-3",children:i?(0,l.jsxs)(l.Fragment,{children:[(0,l.jsx)("div",{className:"relative w-6 h-6",children:(0,l.jsxs)("svg",{className:"w-6 h-6 transform -rotate-90",children:[(0,l.jsx)("circle",{cx:"12",cy:"12",r:"10",fill:"none",stroke:"rgba(255,255,255,0.3)",strokeWidth:"2"}),(0,l.jsx)("circle",{cx:"12",cy:"12",r:"10",fill:"none",stroke:"white",strokeWidth:"2",strokeDasharray:62.83,strokeDashoffset:62.83-62.83*r/100,className:"transition-all duration-100"})]})}),(0,l.jsxs)("span",{children:["Hold to Dismiss... ",Math.floor(r),"%"]})]}):(0,l.jsxs)(l.Fragment,{children:[(0,l.jsx)(p.NO,{size:24}),(0,l.jsx)("span",{children:"HOLD 3 SECONDS TO DISMISS"})]})})]}),(0,l.jsx)("p",{className:"text-center text-slate-500 text-xs mt-3",children:"Hold the button for 3 seconds to acknowledge and dismiss this emergency alert"})]})]})]}):null}function y(e){let{alert:t,escalationLevel:s,onAcknowledge:a,isEmergency:r}=e,n=j[t.severity],i=D(t.createdAt),c=s>=4?"bg-red-500 animate-pulse":s>=3?"bg-orange-500":s>=2?"bg-yellow-500":"bg-emerald-500";return(0,l.jsxs)("div",{className:"p-4 ".concat(n.bg," relative ").concat(r?"ring-2 ring-red-500 animate-pulse":""),children:[(0,l.jsx)("div",{className:"absolute left-0 top-0 bottom-0 w-1 ".concat(c)}),(0,l.jsxs)("div",{className:"flex gap-3",children:[t.thumbnailUrl&&(0,l.jsx)("div",{className:"w-16 h-16 rounded-lg bg-slate-700 overflow-hidden flex-shrink-0",children:(0,l.jsx)("img",{src:t.thumbnailUrl,alt:"Alert thumbnail",className:"w-full h-full object-cover"})}),(0,l.jsxs)("div",{className:"flex-1 min-w-0",children:[(0,l.jsxs)("div",{className:"flex items-start justify-between gap-2",children:[(0,l.jsxs)("div",{className:"flex items-center gap-2",children:[(0,l.jsx)(p.Dp,{size:16,className:n.text}),(0,l.jsx)("span",{className:"text-sm font-medium ".concat(n.text," capitalize"),children:t.severity}),r&&(0,l.jsx)("span",{className:"px-1.5 py-0.5 bg-red-500 text-white text-xs rounded animate-pulse",children:"EMERGENCY"})]}),(0,l.jsx)("span",{className:"text-xs text-slate-500",children:i})]}),(0,l.jsx)("p",{className:"text-sm text-white mt-1 line-clamp-2",children:t.message}),(0,l.jsxs)("div",{className:"flex items-center justify-between mt-2",children:[(0,l.jsxs)("span",{className:"text-xs text-slate-500",children:["Level ",s]}),(0,l.jsxs)("button",{onClick:()=>a(t.id),className:"px-3 py-1 bg-emerald-500/20 text-emerald-400 rounded text-xs font-medium hover:bg-emerald-500/30 transition-colors flex items-center gap-1",children:[(0,l.jsx)(p.NO,{size:12}),"Acknowledge"]})]})]})]})]})}function k(e){let{alerts:t}=e,[s,r]=(0,a.useState)(!1);return(0,l.jsxs)("div",{className:"bg-slate-700/20",children:[(0,l.jsxs)("button",{onClick:()=>r(!s),className:"w-full p-3 flex items-center justify-between text-slate-400 hover:text-white transition-colors",children:[(0,l.jsxs)("span",{className:"text-sm",children:[t.length," acknowledged alert",1!==t.length?"s":""]}),(0,l.jsx)("span",{className:"text-xs",children:s?"▲":"▼"})]}),s&&(0,l.jsxs)("div",{className:"divide-y divide-slate-700/30",children:[t.slice(0,5).map(e=>(0,l.jsx)("div",{className:"p-3 opacity-60",children:(0,l.jsxs)("div",{className:"flex items-center gap-2 text-sm",children:[(0,l.jsx)(p.NO,{size:14,className:"text-emerald-500"}),(0,l.jsx)("span",{className:"text-slate-300 truncate",children:e.message}),(0,l.jsx)("span",{className:"text-xs text-slate-500 ml-auto",children:D(e.createdAt)})]})},e.id)),t.length>5&&(0,l.jsxs)("div",{className:"p-3 text-center text-xs text-slate-500",children:["+ ",t.length-5," more"]})]})]})}function C(){return(0,l.jsxs)("div",{className:"p-8 text-center",children:[(0,l.jsx)("div",{className:"w-12 h-12 rounded-full bg-slate-700/50 flex items-center justify-center mx-auto mb-3",children:(0,l.jsx)(p.NO,{size:24,className:"text-emerald-500 opacity-50"})}),(0,l.jsx)("p",{className:"text-slate-400 text-sm",children:"No active alerts"}),(0,l.jsx)("p",{className:"text-slate-500 text-xs mt-1",children:"Monitoring is running normally"})]})}function D(e){let t=Math.floor((Date.now()-new Date(e).getTime())/1e3);return t<60?"just now":t<3600?"".concat(Math.floor(t/60),"m ago"):t<86400?"".concat(Math.floor(t/3600),"h ago"):"".concat(Math.floor(t/86400),"d ago")}var E=s(26435);function M(e){let{className:t=""}=e,[s,r]=(0,a.useState)(!1),[n,i]=(0,a.useState)(!1),{activePresetId:c,globalSettings:d,globalMute:o,emergencyModeActive:u,setActivePreset:x,updateGlobalSettings:m,toggleGlobalMute:h,activateEmergencyMode:b,deactivateEmergencyMode:v}=(0,g.F2)(),j=(0,f.Z)(),N=(0,E.zn)();if((0,a.useEffect)(()=>{i(!0)},[]),!n)return null;let w=Object.values(g.pP);return(0,l.jsxs)("div",{className:"fixed bottom-4 right-4 z-50 ".concat(t),children:[!s&&(0,l.jsxs)("button",{onClick:()=>r(!0),className:"group flex items-center gap-2 bg-slate-800/90 backdrop-blur-sm border border-slate-700/50  rounded-xl px-4 py-3 shadow-lg hover:bg-slate-700/90 transition-all",children:[(0,l.jsx)(p.iC,{size:20,className:"text-emerald-500 group-hover:rotate-90 transition-transform duration-300"}),(0,l.jsx)("span",{className:"text-white font-medium",children:"Quick Settings"}),(0,l.jsx)(p.y_,{size:16,className:"text-slate-400"})]}),s&&(0,l.jsxs)("div",{className:"bg-slate-800/95 backdrop-blur-sm border border-slate-700/50 rounded-2xl shadow-2xl  w-80 overflow-hidden animate-in",children:[(0,l.jsxs)("div",{className:"flex items-center justify-between p-4 border-b border-slate-700/50",children:[(0,l.jsxs)("div",{className:"flex items-center gap-2",children:[(0,l.jsx)(p.iC,{size:18,className:"text-emerald-500"}),(0,l.jsx)("span",{className:"text-white font-semibold",children:"Quick Settings"})]}),(0,l.jsx)("button",{onClick:()=>r(!1),className:"p-1.5 rounded-lg hover:bg-slate-700/50 text-slate-400 hover:text-white transition-colors",children:(0,l.jsx)(p.C2,{size:18})})]}),(0,l.jsxs)("div",{className:"p-4 space-y-4",children:[(0,l.jsxs)("div",{children:[(0,l.jsx)("label",{className:"text-xs text-slate-400 uppercase tracking-wider mb-2 block",children:"Security Preset"}),(0,l.jsx)("div",{className:"grid grid-cols-2 gap-2",children:w.map(e=>(0,l.jsx)("button",{onClick:()=>x(e.id),className:"p-2 rounded-lg text-xs font-medium transition-all ".concat(c===e.id?"bg-emerald-500 text-white":"bg-slate-700/50 text-slate-300 hover:bg-slate-700"),children:e.name},e.id))})]}),(0,l.jsxs)("div",{className:"grid grid-cols-3 gap-2",children:[(0,l.jsx)(S,{icon:(0,l.jsx)(p.Lj,{size:18}),label:"Motion",active:d.motionDetectionEnabled,onChange:e=>m({motionDetectionEnabled:e})}),(0,l.jsx)(S,{icon:(0,l.jsx)(p.bl,{size:18}),label:"Audio",active:d.audioDetectionEnabled,onChange:e=>m({audioDetectionEnabled:e})}),(0,l.jsx)(S,{icon:(0,l.jsx)(p.xq,{size:18}),label:"Pixel",active:d.pixelDetectionEnabled,onChange:e=>m({pixelDetectionEnabled:e})})]}),(0,l.jsxs)("div",{children:[(0,l.jsxs)("div",{className:"flex items-center justify-between mb-2",children:[(0,l.jsx)("label",{className:"text-xs text-slate-400 uppercase tracking-wider",children:"Alert Volume"}),(0,l.jsxs)("span",{className:"text-xs text-emerald-500 font-mono",children:[d.alertVolume,"%"]})]}),(0,l.jsxs)("div",{className:"flex items-center gap-3",children:[(0,l.jsx)("button",{onClick:h,className:"p-2 rounded-lg transition-colors ".concat(o?"bg-red-500/20 text-red-400":"bg-slate-700/50 text-slate-400 hover:text-white"),children:o?(0,l.jsx)(p.dr,{size:18}):(0,l.jsx)(p.ue,{size:18})}),(0,l.jsx)("input",{type:"range",min:"0",max:"100",value:d.alertVolume,onChange:e=>m({alertVolume:parseInt(e.target.value)}),className:"flex-1 h-2 rounded-full appearance-none bg-slate-700  [&::-webkit-slider-thumb]:appearance-none [&::-webkit-slider-thumb]:w-4  [&::-webkit-slider-thumb]:h-4 [&::-webkit-slider-thumb]:rounded-full  [&::-webkit-slider-thumb]:bg-emerald-500 [&::-webkit-slider-thumb]:cursor-pointer"})]})]}),(0,l.jsxs)("div",{className:"space-y-3",children:[(0,l.jsx)(z,{label:"Motion Sensitivity",value:d.motionSensitivity,onChange:e=>m({motionSensitivity:e})}),(0,l.jsx)(z,{label:"Audio Sensitivity",value:d.audioSensitivity,onChange:e=>m({audioSensitivity:e})})]}),(0,l.jsx)("div",{className:"pt-2 border-t border-slate-700/50",children:(0,l.jsxs)("button",{onClick:()=>{u?v():b("manual")},className:"w-full py-3 rounded-xl font-semibold flex items-center justify-center gap-2 transition-all ".concat(u?"bg-red-500 text-white animate-pulse":"bg-slate-700/50 text-slate-300 hover:bg-red-500/20 hover:text-red-400"),children:[(0,l.jsx)(p.Dp,{size:18}),u?"EMERGENCY MODE ACTIVE":"Enable Emergency Mode"]})}),(0,l.jsxs)("div",{children:[(0,l.jsx)("label",{className:"text-xs text-slate-400 uppercase tracking-wider mb-2 block",children:"Test Sounds"}),(0,l.jsxs)("div",{className:"flex gap-2",children:[(0,l.jsx)(A,{label:"Notification",onClick:()=>j.test("notification")}),(0,l.jsx)(A,{label:"Alert",onClick:()=>j.test("alert")}),(0,l.jsx)(A,{label:"Warning",onClick:()=>j.test("warning")}),(0,l.jsx)(A,{label:"Alarm",onClick:()=>j.test("alarm")})]})]}),!N.isGranted&&(0,l.jsxs)("button",{onClick:N.requestPermission,className:"w-full py-2 px-4 bg-blue-500/20 text-blue-400 rounded-lg text-sm  flex items-center justify-center gap-2 hover:bg-blue-500/30 transition-colors",children:[(0,l.jsx)(p.YK,{size:16}),"Enable Browser Notifications"]})]})]})]})}function S(e){let{icon:t,label:s,active:a,onChange:r}=e;return(0,l.jsxs)("button",{onClick:()=>r(!a),className:"flex flex-col items-center gap-1 p-3 rounded-lg transition-all ".concat(a?"bg-emerald-500/20 text-emerald-400 border border-emerald-500/30":"bg-slate-700/50 text-slate-400 border border-transparent hover:bg-slate-700"),children:[t,(0,l.jsx)("span",{className:"text-xs",children:s}),(0,l.jsx)("div",{className:"w-3 h-3 rounded-full ".concat(a?"bg-emerald-500":"bg-slate-600")})]})}function z(e){let{label:t,value:s,onChange:a}=e;return(0,l.jsxs)("div",{children:[(0,l.jsxs)("div",{className:"flex items-center justify-between mb-1",children:[(0,l.jsx)("label",{className:"text-xs text-slate-400",children:t}),(0,l.jsxs)("span",{className:"text-xs text-emerald-500 font-mono",children:[s,"%"]})]}),(0,l.jsx)("input",{type:"range",min:"0",max:"100",value:s,onChange:e=>a(parseInt(e.target.value)),className:"w-full h-1.5 rounded-full appearance-none bg-slate-700  [&::-webkit-slider-thumb]:appearance-none [&::-webkit-slider-thumb]:w-3  [&::-webkit-slider-thumb]:h-3 [&::-webkit-slider-thumb]:rounded-full  [&::-webkit-slider-thumb]:bg-emerald-500 [&::-webkit-slider-thumb]:cursor-pointer"})]})}function A(e){let{label:t,onClick:s}=e;return(0,l.jsx)("button",{onClick:s,className:"flex-1 py-1.5 px-2 bg-slate-700/50 rounded text-xs text-slate-300  hover:bg-slate-700 hover:text-white transition-colors",children:t})}var I=s(4542),R=s(79286);function F(){let{isConnected:e,isStreaming:t,streamId:s,scenario:n,motionScore:i,audioLevel:c,setConnected:d,setStreaming:o,setStreamId:x,setMotionScore:m,setAudioLevel:h,addAlert:g}=(0,b.m5)(),{selectedScenario:f}=(0,I.w1)(),p=(0,a.useCallback)(e=>{var t,s,l,a,r,n,i;switch(e.type){case"stream-started":o(!0),x(null===(t=e.payload)||void 0===t?void 0:t.streamId);break;case"stream-stopped":o(!1),x(null);break;case"alert":g({id:(null===(s=e.payload)||void 0===s?void 0:s.id)||Date.now().toString(),streamId:(null===(l=e.payload)||void 0===l?void 0:l.streamId)||"",alertType:(null===(a=e.payload)||void 0===a?void 0:a.alertType)||"detection",severity:(null===(r=e.payload)||void 0===r?void 0:r.severity)||"medium",message:(null===(n=e.payload)||void 0===n?void 0:n.message)||"Alert detected",createdAt:new Date().toISOString(),timestamp:(null===(i=e.payload)||void 0===i?void 0:i.timestamp)||new Date().toISOString(),acknowledged:!1})}},[o,x,g]),{sendMessage:v,isConnected:j,connect:w}=(0,R.sO)("ws://localhost:3001",{onMessage:p,onConnect:()=>d(!0),onDisconnect:()=>d(!1)}),y=e=>{t&&v({type:"frame",payload:{frame:e.imageData,motionScore:e.motionScore,audioLevel:e.audioLevel}})},k=e=>{m(e)},C=e=>{h(e)};return(0,a.useEffect)(()=>{if(!j)return;let e=setInterval(()=>{v({type:"ping"})},3e4);return()=>clearInterval(e)},[j,v]),(0,l.jsxs)("div",{className:"min-h-screen bg-gradient-to-br from-gray-900 via-gray-800 to-gray-900",children:[(0,l.jsx)("header",{className:"border-b border-gray-700 bg-gray-900/50 backdrop-blur-sm sticky top-0 z-50",children:(0,l.jsx)("div",{className:"max-w-7xl mx-auto px-4 sm:px-6 lg:px-8",children:(0,l.jsxs)("div",{className:"flex items-center justify-between h-16",children:[(0,l.jsxs)("div",{className:"flex items-center gap-3",children:[(0,l.jsx)(r.default,{href:"/",className:"text-2xl hover:scale-110 transition-transform",children:"\uD83D\uDEE1️"}),(0,l.jsx)("h1",{className:"text-xl font-bold text-white",children:"Live Monitor"}),(0,l.jsxs)("div",{className:"flex items-center gap-2 px-3 py-1 rounded-full text-sm ".concat(j?"bg-green-500/20 text-green-400":"bg-red-500/20 text-red-400"),children:[(0,l.jsx)("div",{className:"w-2 h-2 rounded-full ".concat(j?"bg-green-400":"bg-red-400")}),j?"Connected":"Disconnected"]})]}),(0,l.jsxs)("div",{className:"flex items-center gap-4",children:[!j&&(0,l.jsx)("button",{onClick:w,className:"px-4 py-2 bg-blue-600 hover:bg-blue-700 text-white rounded-lg transition-colors",children:"Reconnect"}),j&&!t&&(0,l.jsx)("button",{onClick:()=>{v({type:"start-stream",payload:{scenario:f||n}})},className:"px-4 py-2 bg-green-600 hover:bg-green-700 text-white rounded-lg transition-colors",children:"Start Monitoring"}),t&&(0,l.jsx)("button",{onClick:()=>{v({type:"stop-stream"})},className:"px-4 py-2 bg-red-600 hover:bg-red-700 text-white rounded-lg transition-colors",children:"Stop Monitoring"})]})]})})}),(0,l.jsx)("main",{className:"max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-6",children:(0,l.jsxs)("div",{className:"grid grid-cols-1 lg:grid-cols-3 gap-6",children:[(0,l.jsxs)("div",{className:"lg:col-span-2",children:[(0,l.jsxs)("div",{className:"bg-gray-800/50 rounded-xl border border-gray-700 overflow-hidden",children:[(0,l.jsx)("div",{className:"p-4 border-b border-gray-700",children:(0,l.jsx)("h2",{className:"font-semibold text-white",children:"Camera Feed"})}),(0,l.jsx)(u,{scenario:f||n||void 0,onFrame:e=>{y(e),k(e.motionScore),C(e.audioLevel)},showDebug:!0})]}),(0,l.jsxs)("div",{className:"mt-4 grid grid-cols-2 sm:grid-cols-4 gap-4",children:[(0,l.jsx)(T,{label:"Motion",value:i.toFixed(1),unit:"%",color:i>30?"yellow":"green"}),(0,l.jsx)(T,{label:"Audio",value:c.toFixed(1),unit:"%",color:c>30?"yellow":"green"}),(0,l.jsx)(T,{label:"Stream",value:t?"Active":"Inactive",color:t?"green":"gray"}),(0,l.jsx)(T,{label:"Mode",value:f||n||"None",color:"blue"})]})]}),(0,l.jsx)("div",{className:"bg-gray-800/50 rounded-xl border border-gray-700 overflow-hidden min-h-[400px]",children:(0,l.jsx)(N,{})})]})}),(0,l.jsx)(M,{})]})}function T(e){let{label:t,value:s,unit:a,color:r}=e;return(0,l.jsxs)("div",{className:"p-4 rounded-lg ".concat({green:"bg-green-500/20 text-green-400",yellow:"bg-yellow-500/20 text-yellow-400",red:"bg-red-500/20 text-red-400",blue:"bg-blue-500/20 text-blue-400",gray:"bg-gray-500/20 text-gray-400"}[r]," border border-current/20"),children:[(0,l.jsx)("div",{className:"text-xs uppercase mb-1",children:t}),(0,l.jsxs)("div",{className:"text-xl font-bold capitalize",children:[s,a&&(0,l.jsx)("span",{className:"text-sm ml-1",children:a})]})]})}}},function(e){e.O(0,[648,883,881,471,365,517,971,117,744],function(){return e(e.s=9291)}),_N_E=e.O()}]);